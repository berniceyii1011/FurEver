<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FurEver | Pet Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<!-- 自定义样式 -->
<link rel="stylesheet" href="style.css">
</head>

<body>

<header>
  <a href="index.html">Home</a>
  <a href="pets.html">Pets</a>
  <a href="calendar.html">Calendar</a>
  <a href="map.html" class="active">Map</a>
  <a href="profile.html">Profile</a>
</header>

<div id="filterBox">
  <label><input type="checkbox" id="showVet" checked> Veterinary Clinics</label>
  <label><input type="checkbox" id="showPet" checked> Pet Stores</label>
</div>

<div id="map"></div>
<div id="infoBox"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// 初始化地图
const map = L.map("map").setView([4.2105, 101.9758], 6);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 18 }).addTo(map);

const infoBox = document.getElementById("infoBox");
let vetMarkers = L.layerGroup().addTo(map);
let petMarkers = L.layerGroup().addTo(map);

// Overpass API 查询
const overpassQuery = `
[out:json][timeout:25];
area["ISO3166-1"="MY"][admin_level=2]->.searchArea;
(
  node["shop"="pet"](area.searchArea);
  node["amenity"="veterinary"](area.searchArea);
);
out body;
>;
out skel qt;
`;

fetch("https://overpass-api.de/api/interpreter", { method: "POST", body: overpassQuery })
.then(res => res.json())
.then(data => {
  data.elements.forEach(el => {
    if(!el.lat || !el.lon) return;
    const name = el.tags.name || "Unknown";
    const type = el.tags.shop || el.tags.amenity || "Unknown";
    const addr = el.tags["addr:full"] || el.tags["addr:street"] || "Address not available";
    const phone = el.tags.phone || el.tags["contact:phone"] || "Phone not available";
    const opening = el.tags.opening_hours || "Opening hours not available";

    const iconUrl = type === "veterinary" ? "icons/veterinary.png" : "icons/petstore.png";
    const icon = L.icon({ iconUrl, iconSize: [25,41], iconAnchor: [12,41], popupAnchor:[1,-34] });

    const marker = L.marker([el.lat, el.lon], {icon}).bindPopup(`<b>${name}</b><br>${type}`);
    marker.on('click', () => {
      infoBox.innerHTML = `<h3>${name}</h3>
        <p>Type: ${type}</p>
        <p>Address: ${addr}</p>
        <p>Phone: ${phone}</p>
        <p>Opening Hours: ${opening}</p>`;
      infoBox.style.display = 'block';
    });

    if(type === "veterinary") vetMarkers.addLayer(marker);
    else petMarkers.addLayer(marker);
  });
});

// 筛选功能
document.getElementById("showVet").addEventListener("change", e => {
  e.target.checked ? map.addLayer(vetMarkers) : map.removeLayer(vetMarkers);
});
document.getElementById("showPet").addEventListener("change", e => {
  e.target.checked ? map.addLayer(petMarkers) : map.removeLayer(petMarkers);
});
</script>

</body>
</html>
