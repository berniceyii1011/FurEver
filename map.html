<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FurEver | Pet Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="content">
  <header>
    <div class="logo">
      <img src="final.png" alt="FurEver Logo">
    </div>

    <div class="hamburger" onclick="toggleSidebar()">☰</div>

    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="pets.html">Pets</a>
      <a href="calendar.html">Calendar</a>
      <a href="map.html" class="active">Map</a>
      <a href="profile.html">Profile</a>
      <a href="#" id="loginBtn">Login/Sign up</a>
    </nav>

    <div class="sidebar" id="sidebar">
      <a href="index.html">Home</a>
      <a href="pets.html">Pets</a>
      <a href="calendar.html">Calendar</a>
      <a href="map.html">Map</a>
      <a href="profile.html">Profile</a>
      <a href="">Login/Sign up</a>
    </div>
  </header>

  <div id="map"></div>
  <div id="filterBox">
    <label><input type="checkbox" id="showVet" checked> Veterinary Clinics <img src="location icon brown.png" alt="Veterinary clicnic pin"></label>
    <label><input type="checkbox" id="showPet" checked> Pet Stores <img src="location icon gold.png" alt="Pet Stores pin"></label>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// 初始化地图（关闭缩放控件）
const map = L.map("map", { zoomControl: false }).setView([4.2105, 101.9758], 6);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 18 }).addTo(map);

let vetMarkers = L.layerGroup().addTo(map);
let petMarkers = L.layerGroup().addTo(map);

// Overpass API 查询
const overpassQuery = `
[out:json][timeout:25];
area["ISO3166-1"="MY"][admin_level=2]->.searchArea;
(
  node["shop"="pet"](area.searchArea);
  way["shop"="pet"](area.searchArea);
  relation["shop"="pet"](area.searchArea);
  node["amenity"="veterinary"](area.searchArea);
  way["amenity"="veterinary"](area.searchArea);
  relation["amenity"="veterinary"](area.searchArea);
);
out body;
>;
out skel qt;
`;

fetch("https://overpass-api.de/api/interpreter", { method: "POST", body: overpassQuery })
.then(res => res.json())
.then(data => {
  data.elements.forEach(el => {
    if(!el.lat || !el.lon) return;
    const name = el.tags.name || "Unknown";
    const type = el.tags.shop || el.tags.amenity || "Unknown";

    const iconUrl = type === "veterinary" ? "location icon brown.png" : "location icon gold.png";
    const icon = L.icon({ iconUrl, iconSize: [25,41], iconAnchor: [12,41], popupAnchor:[1,-34] });

    // 只显示店名 popup
    const marker = L.marker([el.lat, el.lon], {icon})
      .bindPopup(`<b>${name}</b>`)
      .addTo(map);

    if(type === "veterinary") vetMarkers.addLayer(marker);
    else petMarkers.addLayer(marker);
  });
});

// 筛选功能
document.getElementById("showVet").addEventListener("change", e => {
  e.target.checked ? map.addLayer(vetMarkers) : map.removeLayer(vetMarkers);
});
document.getElementById("showPet").addEventListener("change", e => {
  e.target.checked ? map.addLayer(petMarkers) : map.removeLayer(petMarkers);
});

function toggleSidebar() { document.getElementById("sidebar").classList.toggle("active"); }
</script>

</body>
</html>
